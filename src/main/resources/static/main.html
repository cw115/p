<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>ë©”ì¸ í˜ì´ì§€</title>
<style>
:root{--gap:10px;--radius:10px;--line:#e9edf2;--text:#1f2937;--sub:#6b7280;--blue:#2563eb;}
*{box-sizing:border-box;}
body{margin:0;padding:24px;font-family:sans-serif;color:var(--text);background:#f8fafc;}
h1{font-size:24px;margin:0;}
h2{font-size:18px;margin:0 0 10px;border-bottom:1px solid var(--line);padding-bottom:5px;}
.container{max-width:800px;margin:0 auto;}
.card{background:#fff;border:1px solid var(--line);border-radius:14px;padding:20px;box-shadow:0 4px 16px rgba(0,0,0,.03);margin-bottom:20px;}
input,button{height:40px;padding:0 12px;border-radius:10px;border:1px solid var(--line);outline:none;}
button{cursor:pointer;font-weight:600;transition:background .1s;}
button.primary{background:var(--blue);color:#fff;border-color:var(--blue);}
button.ghost{background:none;border:1px solid var(--line);}
.project-item{display:flex;justify-content:space-between;align-items:center;padding:15px 20px;border:1px solid var(--line);border-radius:10px;margin-bottom:10px;cursor:pointer;background:#fff;transition:border-color .1s;}
.project-item:hover{border-color:var(--blue);background:#f9fafb;}
.project-info h3{margin:0;font-size:18px;}
.project-info p{margin:3px 0 0;font-size:14px;color:var(--sub);}
.muted{color:var(--sub);font-size:14px;}
.header-nav{display:flex;justify-content: space-between;align-items:center;margin-bottom:20px;}
</style>
</head>
<body>
<div class="container">
    <div class="header-nav">
        <h1>ğŸ—ï¸ ë©”ì¸: í”„ë¡œì íŠ¸ ëª©ë¡</h1>
        <div>
            <button onclick="location.href='board.html'" class="ghost">í† ë¡ /ì°¬ë°˜ ê²Œì‹œíŒ</button>
            <button onclick="location.href='mypage.html'" class="ghost">ë§ˆì´ í˜ì´ì§€</button>
            <button onclick="logout()" class="ghost" style="color:#ef4444;">ë¡œê·¸ì•„ì›ƒ</button>
        </div>
    </div>

    <div class="card">
        <h2>ìƒˆ í”„ë¡œì íŠ¸ ì¶”ê°€</h2>
        <div style="display:flex;gap:10px;">
            <input id="projectName" type="text" placeholder="í”„ë¡œì íŠ¸ ì´ë¦„ ì…ë ¥" style="flex:1;">
            <button id="addProjectBtn" class="primary" style="width:120px;">í”„ë¡œì íŠ¸ ìƒì„±</button>
        </div>
    </div>

    <div class="card">
        <h2>ì§„í–‰ ì¤‘ì¸ í”„ë¡œì íŠ¸</h2>
        <div id="projectList"><p class="muted">í”„ë¡œì íŠ¸ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p></div>
    </div>
</div>

<script>
if(!localStorage.getItem('userToken')){alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');window.location.href='login.html';}

const API_BASE='/api';

async function api(endpoint,method='GET',body=null){
    const token=localStorage.getItem('userToken');
    const res=await fetch(`${API_BASE}${endpoint}`,{
        method,
        headers:{'Content-Type':'application/json','Authorization':token?`Bearer ${token}`:''},
        body:body?JSON.stringify(body):null
    });
    if(res.status===401){alert('ì¸ì¦ ì‹¤íŒ¨');window.location.href='login.html';return null;}
    if(res.status===204)return null;
    const text=await res.text();
    if(!res.ok)throw new Error(text||'Server Error');
    try{return JSON.parse(text);}catch(e){return {message:text};}
}

function logout(){localStorage.removeItem('userToken');localStorage.removeItem('userEmail');window.location.href='login.html';}

function renderProjects(projects){
    const list=document.getElementById('projectList');list.innerHTML='';
    if(!projects||projects.length===0){list.innerHTML='<p class="muted">ë“±ë¡ëœ í”„ë¡œì íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';return;}
    projects.forEach(p=>{
        const item=document.createElement('div');item.className='project-item';
        item.innerHTML=`
        <div class="project-info">
            <h3>${p.projectName} (ID: ${p.projectId})</h3>
            <p>ìƒíƒœ: ${p.status||'N/A'}</p>
        </div>
        <button class="primary" style="height:35px;"
            onclick="location.href='schedule.html?projectId=${p.projectId}&projectTitle=${encodeURIComponent(p.projectName)}'">
            ì¼ì • ê´€ë¦¬ ğŸ—“ï¸
        </button>`;
        list.appendChild(item);
    });
}

async function fetchProjects(){const projects=await api('/projects');renderProjects(projects);}

document.getElementById('addProjectBtn').onclick=async ()=>{
    const name=document.getElementById('projectName').value.trim();if(!name){alert('í”„ë¡œì íŠ¸ ì´ë¦„ ì…ë ¥');return;}
    const newProject=await api('/projects','POST',{projectName:name});
    if(newProject&&newProject.projectId){alert(`"${newProject.projectName}" ìƒì„± ì™„ë£Œ!`);document.getElementById('projectName').value='';fetchProjects();}
    else if(newProject&&newProject.message){alert('ìƒì„± ì‹¤íŒ¨: '+newProject.message);}
};

fetchProjects();
</script>
</body>
</html>
